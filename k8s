#/bin/bash
# Install Docker
sudo yum install yum-utils -y
sudo yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo
sudo yum install docker-ce docker-ce-cli containerd.io -y
# Configure the Docker daemon, in particular to use systemd for the management of the containerâ€™s cgroups.
#sudo mkdir /etc/docker
#cat <<EOF | sudo tee /etc/docker/daemon.json
#{
#  "exec-opts": ["native.cgroupdriver=systemd"],
#  "log-driver": "json-file",
#  "log-opts": {
#    "max-size": "100m"
#  },
#  "storage-driver": "overlay2"
#}
#EOF
sudo systemctl enable docker
sudo systemctl daemon-reload
sudo systemctl start docker
# Set SELinux in permissive mode (effectively disabling it)
sudo setenforce 0
sudo sed -i 's/^SELINUX=enforcing$/SELINUX=permissive/' /etc/selinux/config
# Lastly, we need to disable SWAP to enable the kubelet to work properly
sudo sed -i '/swap/d' /etc/fstab
sudo swapoff -a
# Install k8s
sudo cp /vagrant/Share/kubernetes.repo /etc/yum.repos.d/kubernetes.repo
sudo yum install -y kubelet kubeadm kubectl --disableexcludes=kubernetes
sudo systemctl enable --now kubelet
